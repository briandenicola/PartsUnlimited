# Getting Started#

## Set up your Windows machine
1. Create a Azure Generation VM 
    - SKU - Standard_D8S_v3 #v3 VM SKU is required for nested virtualization 
    - OS  - Windows 2022
1. Install [Visual Studio 2013 Update 5 or later (up through Visual Studio 2019)](http://www.visualstudio.com)
1. Install [chocolatey](https://community.chocolatey.org/install.ps1')
1. Install the following
    - choco install git
    - choco install powershell-core
    - choco install netfx-4.8.1
    - choco install azure-cli
    - choco install docker-desktop
    - choco install kubernetes-helm
    - choco install terraform
    - choco install go-task
    - choco install nuget.commandline
1. Add `C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin` to Path
1. `git clone https://github.com/briandenicola/PartsUnlimited`

## Create Azure Resources
### Setup AKS Cluster
> **Note!** May require AKS Preview features to be enabled. This [script](https://github.com/briandenicola/kubernetes-cluster-setup/blob/main/scripts/aks-preview-features.sh) can be used to assist in that process '
1. az login
1. az aks install-cli
1. cd infrastructure\aks\windows2022
1. `task up -- southcentralus`

###  Setup Azure SQL and Container Registry 
1. `task up -- ${APP_NAME}`
> **Note!** APP_NAME is the randomly generated resource name created above. It will be in form of 'pet_name'-'uuid'. For example 'dog-222553'

## Build the source code
1. az acr login -n partsunlimitedacr.azurecr.io
1. `.\build.ps1 -ACR partsunlimitedacr.azurecr.io`

## Deploy the source code
1. Create deploy\values.yaml
    ```
        replicaCount: 1
        namespace: default
        db:
            connection_string: The connection string to the Azure SQL database
        image:
            repository: partsunlimitedacr.azurecr.io
            app_name: partsunlimited
            tag: The UUID generated by .\build.ps1
    ```
1. cd deploy
1. `helm upgrade -i parts .`
